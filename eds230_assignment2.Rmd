---
title: "EDS 230 Assignment 2"
author: "Elmera Azadpour, Mia Forsline, Alex Vand"
date: "2022-04-12"
output: html_document
---

# Introduction 

The goal of this assignment is to build a simple model to predict almond yield based on the paper by [Lobell et al. (2006)](https://www.sciencedirect.com/science/article/pii/S016819230600308X). 

# Load necessary libraries 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
```

# Function description 

## Key
- `variable_name` = description [units]


## Inputs
- `temp` = minimum temperature in February [degrees C]
- `precip` = average? precipitation in January [mm]


## Parameters
- `temp_coeff1`
- `temp_coeff2`
- `precip_coeff1`
- `precip_coeff2`


## Outputs
- `almond_yield_anomaly` = almond yield anomaly [ton/acre]



## Mathematical model

```{r almond yield anomaly}
almond_yield_anomaly = function(temp,
                                precip,
                                temp_coeff1 = -0.015,
                                temp_coeff2 = -0.0046,
                                precip_coeff1 = -0.07,
                                precip_coeff2 = 0.0043,
                                constant = 0.28){
  
  almond_yield_anomaly <- (temp_coeff1 * temp) + (temp_coeff1 * temp^2) + (precip_coeff1 * precip) + (precip_coeff2 * precip^2) + constant
  
  return(almond_yield_anomaly)
                        }
```




```{r example}
almond_yield_anomaly(temp = 25, precip = 10)
```


## Data

```{r}
# read in the data from .txt file
clim_txt_data_raw <- read.csv(file = "clim.txt", header = T, sep = "")
# I was having trouble with read_delim, not sure why? (Elmera)

# clean data 
clim_txt_data <- clim_txt_data_raw %>% janitor::clean_names()
```


```{r}
## almond yield function, including Tmin February and Total January Precip
almond_yield_anomaly = function(temp,
                                precip,
                                temp_coeff1 = -0.015,
                                temp_coeff2 = -0.0046,
                                precip_coeff1 = -0.07,
                                precip_coeff2 = 0.0043,
                                constant = 0.28) {

temp = clim_txt_data %>% 
  group_by(month, year) %>% 
  summarize(tmin_c=mean(tmin_c))

TminFeb = (temp %>% 
             filter(month==2))$tmin_c 

pcp = clim_txt_data %>% 
  group_by(month, year) %>% 
  summarize(precip =
              sum(precip))

PJan = (pcp %>% 
          filter(month==1))$precip


almond_yield_anomaly =
  (temp_coeff1*TminFeb) + (temp_coeff2*TminFeb**2) +
  (precip_coeff1*PJan) + (precip_coeff2*PJan**2) + constant

return(almond_yield_anomaly)
}

# annual yield 
annual_almond_yield<- cbind(unique(clim_txt_data$year), almond_yield_anomaly(clim_txt_data)) %>%  
  as.data.frame() %>% 
  rename(year = V1,
         yield = V2)

# plotting results
ggplot(annual_almond_yield, 
       aes(year, yield)) + 
  geom_line()+
  geom_point() +
  theme_bw() +
  labs(x = "Year", y = "Almond Yield (tons/acre)")
```



## Generalize temp and precip inputs


```{r}
temp = function(minimum, month_number){
  
  # minimum = TRUE for minimum value // FALSE for maximum value
  # month = number (out of 12) of month of interest
  
 if (minimum == TRUE){
   
   temp <- min(clim_txt_data$tmin_c[clim_txt_data$month == month_number])
   
} else if (minimum == FALSE){
  
  temp <- max(clim_txt_data$tmax_c[clim_txt_data$month == month_number]) 
  
} else {
  
  print("Error: must select TRUE (1) or FALSE (0) for minimum input")
  
}
  
  return(temp)
                        }
```



```{r}
precip = function(month){
  
  # month = number (out of 12) of month of interest
  
   
   precip <- mean(clim_txt_data$precip[clim_txt_data$month == month_number])
   
  
  return(precip)
                        }
```





